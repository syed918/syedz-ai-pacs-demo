<!DOCTYPE html>
<html>
<head>
<title>SYEDZ AI-PACS</title>

<style>
body{
 font-family: Arial;
 background:#e6ebf0;
 margin:0;
}
.header{
 background:#2f6fd6;
 color:white;
 padding:12px;
 font-size:22px;
}
.toolbar{
 background:#d5dbe2;
 padding:8px;
}
table{
 width:100%;
 border-collapse:collapse;
 background:white;
 margin:10px;
}
th{
 background:#2f6fd6;
 color:white;
 padding:6px;
}
td{
 padding:6px;
 border:1px solid #ddd;
 text-align:center;
}
.ai-btn{
 background:#28a745;
 color:white;
 border:none;
 padding:6px 14px;
 cursor:pointer;
}
#result{
 margin:10px;
 padding:12px;
 background:#e7f2ff;
 border-left:5px solid #2f6fd6;
 font-size:15px;
}
</style>
</head>

<body>

<div class="header">SYEDZ AI-PACS</div>

<div class="toolbar">
<input type="file" id="xrayUpload">
<button onclick="runAI()">Analyze X-ray</button>
</div>

<table>
<tr>
<th>Patient</th>
<th>Modality</th>
<th>Study</th>
<th>AI</th>
</tr>
<tr>
<td>PT-001</td>
<td>XRAY</td>
<td>Chest PA</td>
<td><button class="ai-btn" onclick="runAI()">Generate AI</button></td>
</tr>
</table>

<div id="result"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
async function runAI(){

 const file = document.getElementById("xrayUpload").files[0];
 if(!file){
  alert("Upload X-ray first");
  return;
 }

 document.getElementById("result").innerHTML="Running AI analysis...";

 try{

  const reader = new FileReader();

  reader.onload = async function(){

   const response = await fetch(
    "https://syedasrar-syedz-ai-backend.hf.space/api/predict",
    {
     method:"POST",
     headers:{ "Content-Type":"application/json" },
     body: JSON.stringify({
      data:[reader.result]
     })
    }
   );

   const result = await response.json();

   if(!result.data){
    document.getElementById("result").innerHTML="Invalid AI response";
    return;
   }

   const data = result.data[0];

   let output = "<b>AI Pathology Probabilities:</b><br><br>";
   let pdfText = "SYEDZ AI-PACS REPORT\n\n";

   for(let key in data){
    const val = (data[key]*100).toFixed(1);
    output += key + ": " + val + "%<br>";
    pdfText += key + ": " + val + "%\n";
   }

   document.getElementById("result").innerHTML = output;

   generatePDF(pdfText);
  };

  reader.readAsDataURL(file);

 }catch(err){
  document.getElementById("result").innerHTML="AI backend error";
 }
}

function generatePDF(text){

 const { jsPDF } = window.jspdf;
 const doc = new jsPDF();

 doc.setFontSize(16);
 doc.text("SYEDZ AI-PACS REPORT",20,20);

 doc.setFontSize(12);
 const lines = doc.splitTextToSize(text,170);
 doc.text(lines,20,40);

 doc.text("Generated by Syed AI System",20,280);

 doc.save("AI_Report.pdf");
}
</script>

</body>
</html>
