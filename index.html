<script>
async function analyzeAI(){

 const file = document.getElementById("xrayFile").files[0];
 if(!file){
  alert("Upload X-ray first");
  return;
 }

 document.getElementById("result").style.display="block";
 document.getElementById("result").innerHTML="Running AI analysis...";

 const base64 = await toBase64(file);

 const response = await fetch(
  "https://syedasrar-syedz-ai-backend.hf.space/run/predict",
  {
   method:"POST",
   headers:{"Content-Type":"application/json"},
   body:JSON.stringify({data:[base64]})
  }
 );

 const out = await response.json();
 const ai = out.data[0];

 let findings=[];
 let abnormal=false;

 for(let k in ai){
  if(ai[k] > 0.25){   // threshold
   findings.push(k);
   abnormal=true;
  }
 }

 if(!abnormal){
  findings.push("No significant abnormality detected");
 }

 document.getElementById("result").innerHTML =
  "<b>Detected:</b><br>"+findings.join("<br>");

 generatePDF(findings);
}

function generatePDF(findings){

 const win = window.open("", "_blank");

 win.document.write(`
 <html>
 <head>
 <title>AI Radiology Report</title>
 <style>
 body{font-family:Arial;padding:40px;}
 h2{color:#2f6fd6;}
 hr{margin:20px 0;}
 </style>
 </head>
 <body>

 <h2>SYEDZ AI-PACS REPORT</h2>

 <b>Findings:</b>
 <p>${findings.join(", ")}</p>

 <hr>

 <b>Impression:</b>
 <p>${findings.includes("No significant abnormality detected")
 ? "Normal study."
 : findings.join(", ") + " detected. Clinical correlation advised."}</p>

 <hr>
 <b>Generated by:</b> Syed AI Engine<br>
 <b>Date:</b> ${new Date().toLocaleString()}

 <script>
 window.print();
 <\/script>

 </body>
 </html>
 `);

 win.document.close();
}

function toBase64(file){
 return new Promise((res,rej)=>{
  const r=new FileReader();
  r.onload=()=>res(r.result);
  r.onerror=rej;
  r.readAsDataURL(file);
 });
}
</script>
