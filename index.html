<!DOCTYPE html>
<html>
<head>
<title>SYEDZ AI-PACS</title>

<style>
body{font-family:Arial;background:#e6ebf0;margin:0}
.header{background:#2f6fd6;color:white;padding:12px;font-size:22px}
.toolbar{background:#d5dbe2;padding:8px}
table{width:100%;border-collapse:collapse;background:white;margin:10px}
th{background:#2f6fd6;color:white;padding:6px}
td{border:1px solid #ddd;padding:6px;text-align:center}
.ai-btn{background:#28a745;color:white;border:none;padding:5px 10px;cursor:pointer}
#result{margin:10px;padding:10px;background:#e7f2ff;border-left:5px solid #2f6fd6}
</style>
</head>

<body>

<div class="header">SYEDZ AI-PACS</div>

<div class="toolbar">
<input type="file" id="xrayUpload">
<button onclick="analyze()">Analyze X-ray</button>
</div>

<table>
<tr>
<th>Patient</th><th>Modality</th><th>Study</th><th>AI</th>
</tr>
<tr>
<td>PT-001</td><td>XRAY</td><td>Chest PA</td>
<td><button onclick="sendToAI()" class="ai-btn">Generate AI</button>
</tr>
</table>

<div id="result">Upload image and click Analyze.</div>

<script>
async function analyze(){

const file=document.getElementById("xrayUpload").files[0];
if(!file){alert("Upload X-ray first");return;}

const base64 = await toBase64(file);

document.getElementById("result").innerHTML="Running AI model...";

const payload={
  data:[base64]
};

const formData = new FormData();
formData.append("image", file);

const res = await fetch(
  "https://syedasrar-syedz-ai-backend.hf.space/api/predict",
  {
    method: "POST",
    body: formData
  }
);

const data = await res.json();
  }
);

const json=await res.json();
const probs=json.data[0];

let output="<b>AI Pathology Probabilities:</b><br><br>";

for(let k in probs){
  output+=`${k}: ${(probs[k]*100).toFixed(1)}%<br>`;
}

document.getElementById("result").innerHTML=output;

generatePDF(output);
}

function toBase64(file){
return new Promise((resolve,reject)=>{
 const reader=new FileReader();
 reader.onload=()=>resolve(reader.result);
 reader.onerror=error=>reject(error);
 reader.readAsDataURL(file);
});
}

function generatePDF(text){
let win=window.open("","_blank");
win.document.write(`
<h2>SYEDZ AI-PACS REPORT</h2>
<hr>
${text}
<br><br>
Generated: ${new Date().toLocaleString()}
<script>window.print();<\/script>
`);
win.document.close();
}
</script>

</body>
</html>
